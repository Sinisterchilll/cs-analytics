name: Refetch Unresolved Conversations

on:
  schedule:
    # Runs 30 minutes after the fetch job (every 2 hours at :30)
    # Runs at: 00:30, 02:30, 04:30, 06:30, 08:30, 10:30, 12:30, 14:30, 16:30, 18:30, 20:30, 22:30 UTC
    - cron: '30 */2 * * *'
  workflow_dispatch:

jobs:
  refetch:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Refetch unresolved conversations
        run: npm run refetch:run
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY }}
          FRESHCHAT_TOKEN: ${{ secrets.FRESHCHAT_TOKEN }}
          FRESHCHAT_DOMAIN: ${{ secrets.FRESHCHAT_DOMAIN }}
          VERBOSE_LOG: '0'

